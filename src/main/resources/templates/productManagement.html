<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Product Management</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <link rel="stylesheet" th:href="@{/css/productManage.css}">
</head>

<body>
<div class="sidebar">
    <h2>Dashboard</h2>
    <ul>
        <li><a th:href="@{/dashboard/home}">Home</a></li>
        <li><a th:href="@{/dashboard/products}">Products</a></li>
        <li><a th:href="@{/dashboard/order}">Order</a></li>
        <li><a th:href="@{/dashboard/user}">Users</a></li>
        <li><a th:href="@{/dashboard/voucher}">Voucher</a></li>
        <li><a th:href="@{/dashboard/setting}">Settings</a></li>
    </ul>
</div>
<div class="container">
    <div class="container-box">

        <div class="d-flex justify-content-between mb-3">
            <h3>Product List</h3>
            <a class="btn btn-primary" th:href="@{/dashboard/product/add}">+ Add Product</a>
        </div>

        <form th:action="@{/dashboard/products}" method="get"
              class="mb-3 d-flex gap-2">
            <input type="text"
                   name="keyword"
                   class="form-control w-25"
                   placeholder="Search product..."
                   th:value="${keyword}">
            <button type="submit" class="btn btn-secondary">Search</button>
        </form>
        <form method="get"
              th:action="@{/dashboard/products}"
              class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">

            <div class="d-flex align-items-center gap-2 flex-wrap">
                <!-- üîÑ Reset -->
                <a class="btn btn-outline-secondary btn-sm"
                   th:href="@{/dashboard/products}">
                    üîÑ M·∫∑c ƒë·ªãnh
                </a>


                <!-- üí∞ Sort cheap -->
                <a class="btn btn-outline-primary btn-sm"
                   th:href="@{/dashboard/products(sortType='cheap',
categoryId=${categoryId},
quantityFilter=${quantityFilter})}"
                   th:classappend="${sortType == 'cheap'} ? ' active' : ''">
                    üí∞ Gi√° r·∫ª nh·∫•t
                </a>


                <!-- üì¶ Sort stock -->
                <a class="btn btn-outline-success btn-sm"
                   th:href="@{/dashboard/products(sortType='stock',
categoryId=${categoryId},
quantityFilter=${quantityFilter})}"
                   th:classappend="${sortType == 'stock'} ? ' active' : ''">
                    üì¶ T·ªìn kho nhi·ªÅu nh·∫•t
                </a>
            </div>
            <div class="d-flex align-items-center gap-2 flex-wrap">

                <select name="category" class="form-select form-select-sm w-auto">
                    <option value="">Category</option>
                    <option value="PC"
                            th:selected="${category == 'PC'}">
                        PC
                    </option>
                    <option value="Laptop"
                            th:selected="${category == 'Laptop'}">
                        Laptop
                    </option>
                </select>


                <!-- Quantity -->
                <select name="quantityFilter" class="form-select form-select-sm w-auto">
                    <option value="">Quantity</option>
                    <option value="available"
                            th:selected="${quantityFilter == 'available'}">
                        C√≤n h√†ng
                    </option>
                    <option value="low"
                            th:selected="${quantityFilter == 'low'}">
                        S·∫Øp h·∫øt h√†ng
                    </option>
                    <option value="out"
                            th:selected="${quantityFilter == 'out'}">
                        H·∫øt h√†ng
                    </option>
                </select>


                <!-- Hidden gi·ªØ sort khi submit -->
                <input type="hidden" name="sortType" th:value="${sortType}">


                <!-- Submit -->
                <button class="btn btn-primary btn-sm">
                    L·ªçc
                </button>
            </div>

        </form>

        <table class="table table-bordered table-hover">
            <thead>
            <tr>
                <th>No</th>
                <th>Code</th>
                <th>Name</th>
                <th>Description</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Category</th>
                <th>Image</th>
                <th>Actions</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="p, iter : ${products}">
                <td th:text="${iter.index + 1}"></td>
                <td th:text="${p.productCode}"></td>
                <td th:text="${p.productName}"></td>
                <td th:text="${p.productDescription}"></td>
                <td th:text="${p.productPrice}"></td>
                <td th:text="${p.productQuantity}"></td>
                <td th:text="${p.productCategory.categoryName}"></td>
                <td>
                    <img th:src="@{'/images/' + ${p.productImage}}"
                         alt="Product Image"
                         width="80"
                         style="object-fit: cover; border-radius: 6px;">
                </td>
                <td>
                    <a class="btn btn-sm btn-warning btn-action"
                       th:href="@{'/dashboard/product/edit/' + ${p.id}}">Edit</a>

                    <form th:action="@{/dashboard/product/delete}"
                          method="post"
                          style="display:inline"
                          onsubmit="return confirm('Delete this product?')">

                        <input type="hidden" name="id" th:value="${p.id}" />

                        <button type="submit"
                                class="btn btn-sm btn-danger btn-action">
                            Delete
                        </button>
                    </form>
                </td>
            </tr>
            </tbody>

        </table>
    </div>
    <div class="pagination">


        <a class="prev"
           th:if="${currentPage > 0}"
           th:href="@{/dashboard/products(page=${currentPage - 1}, keyword=${keyword})}">
            Prev
        </a>


        <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
<a th:href="@{/dashboard/products(page=${i}, keyword=${keyword})}"
   th:text="${i + 1}"
   th:classappend="${i == currentPage} ? 'active' : ''">
</a>
</span>


        <a class="next"
           th:if="${currentPage < totalPages - 1}"
           th:href="@{/dashboard/products(page=${currentPage + 1}, keyword=${keyword})}">
            Next
        </a>


    </div>

</div>

</body>
</html>
